# 二项式反演

## 四个基本公式

1. $$\ \ \ \ g(n) = \sum_{i = 0}^{n} {(-1)^i \binom{n}{i}f(i)}   \xLeftrightarrow[]{} f(n) = \sum_{i = 0}^{n}{(-1)^i \binom{n}{i}g(i)}$$  

2. $$g(n) = \sum_{i = 0}^n{\binom{n}{i}f(i)}\xLeftrightarrow[]{} f(n) = \sum_{i = 0}^n{(-1)^{n - i}\binom{n}{i}g(i)}$$  

3. $$\ \ \ \ \ g(n) = \sum_{i = n}^N{(-1)^i\binom{i}{n}f(i)}\xLeftrightarrow[]{}f(n) = \sum_{i = n}^{N}{(-1)^i\binom{i}{n}g(i)}$$

4. $$g(n) = \sum_{i = n}^N{\binom{i}{n}f(i)}\xLeftrightarrow[]{}f(n) = \sum_{i = n}^{N}{(-1)^{i - n}\binom{i}{n}g(i)}$$

其中**公式1**和**公式4**最常用

## 证明
以公式一为例给出

如果有左式成立，将$g(n)$代入右边右式，只要证明两边都等于$f(n)$即可。

下面开始证明

首先有如下式子成立
$$\binom{j}{i}\binom{i}{n} = \binom{j}{n}\binom{j - n}{j - i}$$用组合数阶乘公式展开即可证明。

那么将$g(n)$带入右边得到

$$\ \ \ \ \ \ \ \ \ \ \ \ \ \sum_{i = 0}^n{(-1)^i\binom{n}{i}\sum_{j = 0}^{i}{(-1)^j\binom{i}{j}f(j)}}$$

$$\xLeftrightarrow[]{}\sum_{j = 0}^n{f(j)\sum_{i = j}^n{(-1)^{i + j}\binom{n}{i}\binom{i}{j}}}$$

$$\ \ \ \ \ \ \ \ \xLeftrightarrow[]{}\sum_{j = 0}^n{\binom{n}{j}f(j)\sum_{i = j}^n{(-1)^{i + j}\binom{n - j}{n - i}}}$$
$$在j \not ={n}的时候右半个式子为(1-1)^{n - j}的二项式展开因此为0，在j = n时候为f(n)那么证明完成$$

## 应用

### 第四个式子

钦定至少k个 $\xrightarrow{}$ 恰好k个

[P10596 BZOJ2839 集合计数](https://www.luogu.com.cn/problem/P10596)


这里对**钦定**的含义  
$def$ $g(i)$: 任选i个作为钦定，对于钦定不同，我们认为即使选择相同，也认为方案不同，要求选择至少包含钦定的的i个元素的方案数。（这里特别说明:对于不同钦定选择相同是正常出现的，但我们认为不同）

$def$ $f(i)$: 恰好包含i个元素的方案数，那么对于反演式中，$\binom{i}{k}$ 我们认为$f(i)$有$\binom{i}{k}$种k个**钦定**对$g(k)$产生贡献。 

这里题目中 $g(i)$ $=$ $(2 ^ {2 ^ {n - i} - 1})$$\binom{n}{i}$，并且$g(k)$ = $\sum_{i = k}^{n}{\binom{i}{k}}f(i)$，那么$f(k)$ = $\sum_{i = k}^n{(-1)^{i - k}\binom{i}{k}g(i)}$

